<?xml version="1.0"?>
<!--
  ~ Copyright (C) 2016-2019 ActionTech.
  ~ License: http://www.gnu.org/licenses/gpl.html GPL version 2 or higher.
  -->

<!DOCTYPE dble:schema SYSTEM "schema.dtd">
<dble:schema xmlns:dble="http://dble.cloud/" version="2.19.01.0">

    <schema name="tpcc">
        <table name="orders" dataNode="dn1,dn2,dn3,dn4" rule="sharding-by-mod">
            <childTable name="order_line" joinKey="ol_o_id" parentKey="id" />
            <childTable name="new_orders" joinKey="no_o_id" parentKey="id"/>
        </table>

        <table name="stock" primaryKey="id" dataNode="dn1,dn2" rule="sharding-by-string-jump"/>

        <table name="customer" primaryKey="id" dataNode="dn1,dn2,dn3,dn4" rule="sharding-by-hash-str">
            <childTable name="history" joinKey="h_c_id" parentKey="id"/>
        </table>

        <!-- global table -->
        <table name="warehouse" type="global" dataNode="dn1,dn2,dn3,dn4"/>
        <table name="district" type="global" dataNode="dn1,dn2,dn3,dn4"/>
        <table name="item" type="global" dataNode="dn1,dn2,dn3,dn4"/>
    </schema>


    <dataNode name="dn1" dataHost="localhost1" database="db1"/>
    <dataNode name="dn2" dataHost="localhost1" database="db2"/>
    <dataNode name="dn3" dataHost="localhost2" database="db1"/>
    <dataNode name="dn4" dataHost="localhost2" database="db2"/>
    <dataHost name="localhost1" maxCon="1000" minCon="10" balance="0" switchType="1" slaveThreshold="100">
        <heartbeat>show slave status</heartbeat>
        <!-- can have multi write hosts -->
        <writeHost host="hostM1" url="localhost:3306" user="root"
                   password="123456"/>
    </dataHost>

    <dataHost name="localhost2" maxCon="1000" minCon="10" balance="0" switchType="1" slaveThreshold="100">
        <heartbeat>show slave status</heartbeat>
        <writeHost host="hostS1" url="localhost:3307" user="root"
                   password="123456"/>
    </dataHost>
</dble:schema>