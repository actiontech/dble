<?xml version="1.0"?>
<!--
  ~ Copyright (C) 2016-2020 ActionTech.
  ~ License: http://www.gnu.org/licenses/gpl.html GPL version 2 or higher.
  -->

<!DOCTYPE dble:sharding SYSTEM "sharding.dtd">
<dble:sharding xmlns:dble="http://dble.cloud/" version="3.0">
	<schema name="schema1" sqlMaxLimit="100"  shardingNode="dn5">
		<shardingTable name="test1" shardingNode="dn1,dn2,dn3,dn4" function="func_mod" shardingColumn="id" sqlMaxLimit="200" />
		<shardingTable name="test_table" shardingNode="dn1,dn2,dn3,dn4"  function="func_mod" shardingColumn="id" />
		<shardingTable name="sharding_two_node" shardingNode="dn1,dn2" function="two-long" shardingColumn="id"/>
		<shardingTable name="sharding_two_node2" shardingNode="dn1,dn2" function="two-long" shardingColumn="id"/>
		<shardingTable name="sharding_2_t1" shardingNode="dn1,dn2" function="two-long" shardingColumn="id"/>
		<shardingTable name="sharding_4_t1" shardingNode="dn1,dn2,dn3,dn4"  function="func_mod" shardingColumn="id" /></schema>
	<schema name="schema2" sqlMaxLimit="100" shardingNode="dn5">
		<shardingTable name="sharding_2_t2" shardingNode="dn1,dn2" function="two-long" shardingColumn="id"/>
		<shardingTable name="sharding_4_t2" shardingNode="dn1,dn2,dn3,dn4"  function="func_mod" shardingColumn="id" />
	</schema>
	<schema name="schema3" sqlMaxLimit="100" shardingNode="dn5">
	</schema>
	<schema name="testdb" shardingNode="dn1">
		<shardingTable name="sharding_2_t1" shardingNode="dn1,dn2" function="func_common_hash" shardingColumn="id"/>
		<shardingTable name="sharding_two_node" shardingNode="dn1,dn2" function="func_common_hash" shardingColumn="id"/>
		<shardingTable name="sharding_4_t1" shardingNode="dn1,dn2,dn3,dn4" function="func_mod" shardingColumn="id" />

		<singleTable name="table_c" shardingNode="dn1" />
		<globalTable name="tb_global1" shardingNode="dn1,dn3"/>
		<shardingTable name="tb_parent" shardingNode="dn1,dn2" function="func_common_hash" shardingColumn="id">
			<childTable name="tb_child1" joinColumn="child1_id" parentColumn="id">
				<childTable name="tb_grandson1" joinColumn="grandson1_id" parentColumn="child1_id"/>
				<childTable name="tb_grandson2" joinColumn="grandson2_id" parentColumn="child1_id2"/>
			</childTable>
			<childTable name="tb_child2" joinColumn="child2_id" parentColumn="id"/>
			<childTable name="tb_child3" joinColumn="child3_id" parentColumn="id2"/>
		</shardingTable>



	</schema>


	<schema name="testdb2">
		<shardingTable name="sharding_4_t2" shardingNode="dn1,dn2,dn3,dn4" function="func_mod" shardingColumn="id" />
		<globalTable name="global_4_t1" shardingNode="dn1,dn2,dn3,dn4"/>
	</schema>


	<schema name="ermdb" shardingNode="ermdn1"></schema>

	<shardingNode name="ermdn1" dbGroup="dbGroup1" database="erm" />
	<!-- <dataNode name="dn1$0-743" dbGroup="dbGroup1" database="db$0-743" /> -->
	<shardingNode name="dn1" dbGroup="dbGroup1" database="db_1"/>
	<shardingNode name="dn2" dbGroup="dbGroup2" database="db_2"/>
	<shardingNode name="dn3" dbGroup="dbGroup1" database="db_3"/>
	<shardingNode name="dn4" dbGroup="dbGroup2" database="db_4"/>
	<shardingNode name="dn5" dbGroup="dbGroup1" database="db_5"/>
	<shardingNode name="C3_00$0-9" dbGroup="dbGroup1" database="C3_00$0-9"/>
	<shardingNode name="C3_0$10-63" dbGroup="dbGroup1" database="C3_0$10-63"/>
	<!--&lt;!&ndash;<shardingNode name="dn6" dbGroup="dbGroup2" database="db_6"/>&ndash;&gt;-->
	<!--&lt;!&ndash;<shardingNode name="dn7" dbGroup="dbGroup2" database="db_7"/>&ndash;&gt;-->
	<!--<shardingNode name="dn8" dbGroup="dbGroup1" database="yhq_test"/>-->
	<!--<shardingNode name="dn9" dbGroup="dbGroup3" database="yhq_test"/>-->

	<function class="Hash" name="two-long">
		<property name="partitionCount">2</property>
		<property name="partitionLength">1</property>
	</function>
	<function name="rule_simple" class="Hash">
		<property name="partitionCount">4</property>
		<property name="partitionLength">1</property>
	</function>


	<!-- Hash partition,when partitionLength=1, it is a mod partition-->
	<!--MAX(sum(count*length[i]) must not more then 2880-->
	<function name="func_common_hash" class="Hash">
		<property name="partitionCount">2</property>
		<property name="partitionLength">512</property>
	</function>
	<!-- Hash partition,when partitionLength=1, it is a mod partition-->
	<!--MAX(sum(count*length[i]) must not more then 2880-->
	<function name="func_uneven_hash" class="Hash">
		<property name="partitionCount">2,1</property>
		<property name="partitionLength">256,512</property>
	</function>
	<!-- eg:  mod 4 -->
	<function name="func_mod64" class="Hash">
		<property name="partitionCount">64</property>
		<property name="partitionLength">1</property>
	</function>
	<!-- eg:  mod 4 -->
	<function name="func_mod" class="Hash">
		<property name="partitionCount">4</property>
		<property name="partitionLength">1</property>
	</function>


	<function name="func_test" class="Hash">
		<property name="partitionCount">2,3</property>
		<property name="partitionLength">10,5</property>
	</function>
	<!-- jumpStringHash partition for string-->
	<function name="func_jumpHash" class="jumpStringHash">
		<property name="partitionCount">2</property>
		<property name="hashSlice">0:2</property>
	</function>

	<!-- Hash partition for string-->
	<function name="func_hashString" class="StringHash">
		<property name="partitionCount">4</property>
		<property name="partitionLength">256</property>
		<property name="hashSlice">0:2</property>
		<!--<property name="hashSlice">-4:0</property> -->
	</function>

	<!-- date partition -->
	<!-- 4 case:
    1.set sEndDate and defaultNode: input <sBeginDate ,router to defaultNode; input>sEndDate ,mod the period
    2.set sEndDate, but no defaultNode:input <sBeginDate report error; input>sEndDate ,mod the period
    3.set defaultNode without sEndDate: input <sBeginDate router to defaultNode;input>sBeginDate + (node size)*sPartionDay-1 will report error(expected is defaultNode,but can't control now)
    4.sEndDate and defaultNode are all not set: input <sBeginDate report error;input>sBeginDate + (node size)*sPartionDay-1 will report error
     -->
	<function name="func_date" class="Date">
		<property name="dateFormat">yyyy-MM-dd</property>
		<property name="sBeginDate">2015-01-01</property>
		<property name="sEndDate">2015-01-31 </property> <!--if not set sEndDate,then in fact ,the sEndDate = sBeginDate+ (node size)*sPartionDay-1 -->
		<property name="sPartionDay">10</property>
		<property name="defaultNode">0</property><!--the default is -1-->
	</function>

	<!-- pattern partition -->
	<!--mapFile must contains all value of 0~patternValue-1,key and value must be Continuous increase-->
	<function name="func_pattern" class="PatternRange">
		<property name="mapFile">partition-pattern.txt</property>
		<property name="patternValue">1024</property>
		<property name="defaultNode">0</property><!--contains string which is not number,router to default node-->
	</function>
</dble:sharding>